# 課題名

データベース設計のアンチパターン１

# 課題

```
以下のPostのように、tagsカラムの中にカンマ区切りで複数の値を入れている設計を稀に見かけます。

上記の例では、「投稿(Post)」に紐づけられた「タグ」を表現するために、投稿テーブルに「タグ」というカラムを持ち、その中に `tagA, tagB, tagC`といった形でカンマ区切りで格納しています。

この設計だとどのような問題が生じるか、説明してみてください。

💡 「もし将来こんな仕様変更があったら、どれだけ大きなスキーマ変更になるだろうか？」「今の作りだと表現できないユースケースがあるのでは？」など、具体的なケースを沢山仮定して考えてみると良いかもしれません！

カラムの型（varchar）は今の段階では特に気にしないで結構です。

データベース設計の課題領域では「どのようにテーブルを分けるか」「どのカラムにどの情報を格納するか」の2点のみ考えていただくのが目的なので、データ型は今回の考慮対象ではありません。
```

# 結論

- 正規化に違反している
  - 第一正規形の1行1項目の原則を破っている
  - Post ↔ Tag は多対多の関係になっているが中間テーブルを作っていない
    - 1つのタグを別の投稿でも使いたいとき、同じ文字列を各行に複製することになる
  - FK 制約・ユニーク制約を貼れず、タイプミスや表記ゆれを防げない
- インデックスが効かないため検索が遅い
  - `where`で 複数条件を OR でつなぐか正規表現を使うしかない
- 追加要件による弊害
  - タグの詳細属性（説明文・作成者等）が必要になった場合
    - タグごとに紐づけができない
  - タグの階層化・カテゴリ化
    - 親子関係を表現できない
  - 人気タグを出す
    - 文字列 split してカウントするなどをしないといけなく、重くなる
